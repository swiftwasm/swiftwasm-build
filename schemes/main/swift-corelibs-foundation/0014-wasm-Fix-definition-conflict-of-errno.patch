From ec789524f7020ef0e48eab75fd11a7090b6ef5db Mon Sep 17 00:00:00 2001
From: Yuta Saito <kateinoigakukun@gmail.com>
Date: Fri, 23 Feb 2024 04:08:12 +0000
Subject: [PATCH] [wasm] Fix definition conflict of `errno`

WASILibc's `errno` conflicts with Clang-imported `errno` in <errno.h>.
---
 Sources/Foundation/NSPathUtilities.swift | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/Sources/Foundation/NSPathUtilities.swift b/Sources/Foundation/NSPathUtilities.swift
index 51067bc0..32538456 100644
--- a/Sources/Foundation/NSPathUtilities.swift
+++ b/Sources/Foundation/NSPathUtilities.swift
@@ -10,6 +10,15 @@
 @_implementationOnly import CoreFoundation
 #if os(Windows)
 import WinSDK
+#elseif os(WASI)
+import WASILibc
+// CoreFoundation brings <errno.h> but it conflicts with WASILibc.errno
+// definition, so we need to explicitly select the one from WASILibc.
+// This is defined as "internal" since this workaround also used in other files.
+internal var errno: Int32 {
+    get { WASILibc.errno }
+    set { WASILibc.errno = newValue }
+}
 #endif
 
 #if os(Windows)
-- 
2.43.0

